# lifegame
A commandline app written in C that simulates the famous life game.

---- 
**关于本项目文件结构：本文件夹中含有两份`life.c`源文件。UTF-8 编码的源文件在子文件夹 utf 中，GBK 编码的源文件在子文件夹 gbk 中。请选择相应的解码方式打开文件进行编译运行。测试输入文件也均在各自文件夹内。html 文件夹中含有关于函数、全局变量和宏定义的文档。**

---- 
## 程序使用方法
本程序由正常模式、设计模式与自动运行模式三个模式组成。设计模式中可以自定义新细胞图与活细胞位置，自动运行模式中程序每 2s 更新一代细胞图。上述两种模式有较详细的程序指引，按照指引操作即可。正常模式中可以进行其他操作，包括进入设计模式与自动运行模式。其使用方法与命令行类似，由命令与可选的输入参数组成，当程序识别到匹配的命令时，就执行相应的操作。需要对命令有进一步了解可以在正常模式中键入`\h`后按下回车，有较详细说明。
本程序亦可读取文件内的细胞图，格式为：第一行用空格分隔两个小于 120 的正整数，分别为`row`和`col`，接下来`row`行，每行`col`个数，由空格分隔，代表该位置的细胞存活情况，大于 0 时为活细胞，否则为死细胞。空格回车可互换或增减。其他格式不保证读入结果符合用户预期。

---- 
## 程序结构
本程序为单文件程序，主要由一个主函数、若干函数、若干全局变量组成。全局变量通常为一些需要经常全局使用、或占用空间较大的变量。对于程序中的功能，通常由一到两个函数完成，并由主函数调用。此外也有一些函数（如`void get_command(char*, char*, char*)`等）由于其设计巧妙、通用性高而被多个功能的函数调用。

---- 
## 各函数、全局变量、宏定义功能介绍
详见 html 文件夹中的文档。查看方法：进入 html 文件夹，选择 index.html ，使用浏览器打开（双击），即可查看文档。

---- 
## 编写该项目时遇到的困难与解决方案
1. **输入问题。** 在本程序中输入是贯穿很多功能的一个难题。对于运行时的用户输入，我发现没有需要输入超过两个参数的。因此可以用如下的方法进行统一的输入数据处理。先获取一行输入，对其第一个单词与之后的部分进行分割，得到两个前后无空白字符的字符串，第一个只有一个单词，第二个可以由多个单词组成。之后再对分拆后的两个字符串进行处理。这样可以轻松处理输入格式、带空格路径等错误输入的情况，也很容易将字符串转化为数字进行进一步处理。而对于用户的文件输入，我采用浮点数输入细胞图位置信息，并把 0 作为的分界线判断其生死。
2. **文件处理问题。** 我以往进行文件输出通常采用重定向的方式，较为方便。但是在本项目中，可能需要多次在标准输入输出与文件输入输出中转换，重定向较为繁琐。而且定向回标准输入输出与平台有关。因此我还是采用了普通的文件输入输出方法。
3. **设计模式。** 设计模式中用户输入较多，需要引导用户使用，并处理好错误输入。我原来对于长宽采用格式输入，后来发现对于极端输入处理较难，遂与位置同使用统一输入方法。重构时我将二者写在一个循环中，共用输入代码，并且这也使输入长宽错误时能继续输入。此处细节较多。
4. **自动运行模式。** 逻辑不难，循环加状态标记。遇到的很大问题在于如何实现无阻塞输入。我的系统是 MacOS ，没有这方面的原生函数。使用了不少于三种方法，改命令行参数、用第三方库等，效果都不好。最后我还是装上了 Windows 虚拟机，解决了这个问题。
5. **爆栈。** 迁移至 Windows 后运行直接闪退，调试后发现出现段错误，与内存相关。原来是在进行生成下一代细胞图时，用到辅助数组较大，我却在函数内定义，栈空间不够大导致程序异常退出。解决方法就是将这个辅助数组变为全局的。
